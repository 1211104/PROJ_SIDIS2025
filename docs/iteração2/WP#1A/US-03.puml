@startuml
title US-03: Register Physician workflow with Event, Producer and Consumer

actor Administrator
participant "PhysicianController" as controller
participant "JWTValidator" as jwt
participant "PhysicianService" as service
participant "PhysicianRepository" as repo

participant "PhysicianEventProducer" as producer
participant "PhysicianEvent" as event
participant "PhysicianEventConsumer" as consumer

Administrator -> controller : POST /physicians + JWT + physicianDTO
controller -> jwt : validateToken(JWT)
jwt --> controller : 200 OK (role=ADMIN)

controller -> service : registerPhysician(physicianDTO)
service -> repo : save(Physician)
repo --> service : Physician(with ID)

service -> producer : publishPhysicianRegisteredEvent(Physician)
producer -> event : createEvent(Physician)

event -> consumer : PhysicianRegisteredEvent
consumer --> event : ACK

service --> controller : PhysicianDTO (with ID)
controller --> Administrator : 201 Created + PhysicianDTO
@enduml