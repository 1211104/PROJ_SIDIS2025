@startuml US09_Search_Patient_By_Name_Microservices
'https://plantuml.com/sequence-diagram
title US-09: As Administrator, I want to search Patients by name

autonumber
autoactivate on

actor "Administrator" as Admin
participant "PatientController (Patient Service)" as Controller
participant "JWTValidator" as JWT
participant "PatientService" as Service
participant "PatientsRepository" as Repo
database "Patients DB" as DB
participant "PatientMapper" as Mapper

Admin -> Controller : GET /patients/search?name={name}&page={page}\nAuthorization: Bearer <JWT>
activate Controller

Controller -> JWT : validateToken(JWT)
activate JWT
JWT --> Controller : 200 OK (role=ADMIN)
deactivate JWT

Controller -> Service : getPatientsByName(name, page)
activate Service

Service -> Repo : findByNameContainingIgnoreCase(name, pageable)
activate Repo
Repo -> DB : SELECT * FROM patients WHERE name LIKE %name%
DB --> Repo : List<Patient>
deactivate Repo

Repo --> Service : List<Patient>

Service -> Mapper : toPatientDTOList(List<Patient>)
activate Mapper
Mapper --> Service : List<PatientDTO>
deactivate Mapper

Service --> Controller : List<PatientDTO>
deactivate Service

Controller --> Admin : HTTP 200 OK\nBody: List<PatientDTO>
deactivate Controller

@enduml